@page "/servers"

@rendermode InteractiveServer

<h3>Servers</h3>
<br/>
<br/>

<CityListComponent @ref="cityListComponent" SelectCityCallBack="HandleCitySelection" />
<br/>

<SearchBarComponent @ref="searchBarComponent" SearchServerCallback="HandleSearchServer" />
<br />

<CascadingValue Name="SelectedCity" Value="@selectedCity">
  <ServerListComponent CityName="@selectedCity" SearchFilter="@this.searchFilter" />
</CascadingValue>

<p>
  <a href="/servers/add" class="btn btn-primary">Add Server</a>
</p>

@code {
  private string selectedCity = "Toronto";
  private string searchFilter = "";
  private CityListComponent? cityListComponent;
  private SearchBarComponent? searchBarComponent;

  private void HandleSearch()
  {
    @* this.servers = ServersRepository.SearchServers(this.serverFilter); *@
    @* this.selectedCity = string.Empty; *@
  }

  private void HandleCitySelection(string city)
  {
    this.selectedCity = city;
    this.searchFilter = string.Empty;
    searchBarComponent?.ClearFilter();
  }

  private void HandleSearchServer(string searchFilter)
  {
    @* this.servers = ServersRepository.SearchServers(searchFilter); *@
    this.searchFilter = searchFilter;
    this.cityListComponent?.ClearSelection();
  }
}